# AI 旅游规划器 — 产品需求文档（PRD）

版本：1.0
日期：2025-10-28
作者：产品团队（自动生成草案）

## 一、产品概述

AI 旅游规划器是一款 Web 端应用，目标是简化用户的旅行规划流程，通过语音或文字输入由 AI 自动生成个性化行程，并在旅途中提供实时辅助。主打特点：智能化、一站式、可同步云端、多设备使用。

核心价值：
- 大幅减少旅行前的时间成本与信息搜索成本。
- 提供个性化、可执行的行程（交通、住宿、景点、餐饮、预算等）。
- 行程与花费可同步至云端并可多人/多设备协作。

技术栈（前端/后端交互与第三方）：
- 前端框架：Vue 3 + Vite
- UI：Element Plus
- 状态管理：Pinia
- 路由：vue-router
- 语音识别：科大讯飞开放 API
- 地图/导航：高德地图 API
- 后端/认证/存储：Supabase（Postgres + Auth + Storage）
- 行程规划与预算估算：Hunyuan-T1 API（调用 LLM/规划引擎）
- 部署：静态托管（Vercel/Netlify）或自托管（Docker + CDN）

## 二、用户与场景

目标用户画像：
- 自助游用户：希望快速生成短期或长期行程，注重美食、景点或亲子活动。
- 家庭用户：需考虑儿童、预算、出行便捷性。
- 商务/差旅用户：更注重效率、交通与时间成本。

典型场景：
1. 用户通过语音对话描述旅行需求（目的地、时长、预算、偏好）。系统返回一套行程草案。
2. 用户微调行程（替换景点、调整交通、变更住宿等级）。系统即时更新预算与时间表。
3. 用户保存并同步行程到云端，邀请同行者查看或编辑。
4. 旅行中，使用地图导航到景点、查找餐厅，记录实时花费并自动与预算对照。

## 三、产品功能（细化）

### 1. 智能行程规划（核心）
- 输入方式：语音（讯飞）与文字输入
- 参数：目的地、出发/返回日期、预算、同行人数、偏好（美食/文化/亲子/购物/影音/自由行/跟团等）、出行方式（自驾/机/高铁）、起点城市
- 输出：多日行程（日历式视图 + 地图视图），包含：每日行程安排、每段路程的交通建议、推荐住宿、餐厅与场馆信息、预计花费（按项拆分）
- 可交互修改：拖拽行程、替换景点、调整停留时长
- 版本管理：保存多个方案并可比较

实现要点：
- 前端收集结构化需求后，调用 Hunyuan-T1 进行行程生成与预算估算；对 LLM 返回结果做结构化解析（JSON schema），并保存在 Supabase
- 在交互式修改时，增量请求 LLM 更新相关片段以保持连贯性

### 2. 费用预算与管理
- 预算估算：机票/火车/长途/城市交通 + 住宿 + 餐饮 + 门票 + 其他（交通站到酒店的接驳、保险等）
- 实时记账：用户或自动（通过手动输入或拍照/语音输入）记录实际开销
- 预算对比：显示预算使用率、按日/类别统计、提醒超预算
- 导出：CSV/JSON 导出费用明细

实现要点：
- 预算初始估算通过 Hunyuan-T1（基于历史数据/提示词）生成并附置信度
- 真是费用保存在 Supabase，支持离线暂存与同步

### 3. 用户管理与数据存储
- 注册/登录：Supabase Auth（邮箱、第三方 OAuth 可选）
- 用户资料：偏好（饮食、可接受交通时长、旅行节奏）、常用出发地、默认货币
- 数据：旅行计划、费用记录、图片/票据（Supabase Storage）
- 权限：计划所有者可邀请协作者（通过 email 或链接）并设置读写权限
- 云端同步：跨设备同步并解决冲突（基于时间戳与简单合并策略，复杂冲突提示人工合并）

### 4. 地图与导航互动
- 在行程地图视图上呈现每日轨迹、景点标注、推荐路线
- 点击景点显示详情（地址、开放时间、评分、推荐时长、图片）
- 导航：调用高德地图进行步行/驾车/公共交通路线导航（前端打开高德地图 SDK 或跳转到高德 App）

### 5. 语音交互
- 支持语音输入旅行需求和补充信息
- 语音转文字由科大讯飞 API 完成，前端在转换后展示文本供确认
- 支持关键时刻的语音命令，如“下一天行程修改为...”，“记录一笔花费 120 元”

### 6. 辅助功能
- 行程分享（只读/可编辑）
- 行程打印/导出（PDF）
- 行程通知（提醒出发、门票时间等；通过浏览器通知或邮件）
- 多语言支持（初期中文优先）

## 四、非功能性需求

- 性能：关键交互（加载/保存行程、切换日历/地图）响应 < 300ms（本地渲染），API 请求按需优先级处理
- 可用性：支持移动端与桌面端（响应式布局）
- 可扩展性：模块化后端交互（可替换 LLM 或地图提供商）
- 安全与隐私：敏感数据加密传输（HTTPS）、在数据库中对身份证号码等敏感信息加密存储（如果收集）
- 可测试性：前端组件单元测试 + E2E（Cypress/Vitest）

## 五、数据模型（简化）

1. User
- id, email, name, avatar_url, preferences (json), created_at

2. TripPlan
- id, owner_id, title, start_date, end_date, participants (list of user ids), preferences (json), created_at, updated_at

3. DayPlan
- id, trip_id, day_index, date, items (array of DayItem JSON), total_estimated_cost

4. DayItem (JSON)
- id, type (transport|attraction|meal|hotel|free), title, start_time, end_time, location {lat,lng,address}, notes, estimated_cost

5. Expense
- id, trip_id, user_id, amount, currency, category, date, note, receipt_url

6. ShareInvite
- id, trip_id, email, role (viewer|editor), token, expired_at

数据存储优先放在 Supabase（Postgres），文件（照片/票据）放 Supabase Storage

## 六、系统架构（高层）

前端 (Vue3 + Pinia)
- 负责 UI、状态管理、语音采集、显示地图、与后端交互

后端服务（Serverless / Third-party）
- 认证与数据：Supabase
- 行程规划与预算：Hunyuan-T1（LLM 接口），前端/后端封装调用，返回结构化 JSON
- 语音识别：讯飞 API（前端调用或后端代理）
- 地图服务：高德 Web SDK

交互流程示例：
1. 用户输入/语音 -> 前端转文字 -> 构造结构化 prompt -> 调用 Hunyuan-T1 -> 获取 JSON 行程草案 -> 显示并允许编辑 -> 保存到 Supabase
2. 用户修改 -> 前端局部更新并同步 Supabase -> 若需重新规划（如更换景点），发增量请求到 Hunyuan-T1

## 七、API / 接口设计（简要）

前端主要与三类服务通信：Supabase（数据/存储/认证）、Hunyuan-T1（规划）、科大讯飞（语音）。

示例：
- POST /api/plan/generate
  - 输入：{destination, start_date, end_date, budget, pax, preferences, start_city}
  - 后端/前端调用 Hunyuan-T1，返回结构化 {tripPlanJson, costBreakdown, confidence}

- GET /api/places/nearby?lat=...&lng=...&type=restaurant
  - 调用高德或本地缓存的 POI 数据，返回列表

（注意：可将所有第三方调用在前端直接完成或由后端代理，若存在 API Key 泄露风险，建议在后端中转）

## 八、前端页面与组件设计（Vue3 + Element Plus）

主要页面：
- 登录/注册页面（Supabase Auth）
- 首页 / 新建行程向导（语音或表单输入）
- 行程详情页（左侧日历/列表，右侧地图）
- 费用管理页（记账、分类、导出）
- 我的行程（列表、搜索、分享）
- 设置（偏好、通知、账号）

关键组件：
- VoiceInput（封装讯飞语音采集与转写）
- PlanEditor（行程编辑器，支持拖拽与日历视图）
- MapView（封装高德地图标注、路径、导航入口）
- ExpenseTracker（费用录入/报表）
- ShareModal（分享/邀请管理）

状态管理：Pinia store 分为 userStore、tripStore、uiStore、mapStore

UI 交互建议：
- 使用 Element Plus 的布局与表单组件，加速开发
- 地图与行程编辑为自定义组件，尽量保持小而可复用

## 九、验收标准（Acceptance Criteria）

MVP 验收条件：
1. 用户能通过文字/语音输入目的地与偏好，系统返回一份可编辑的 3-5 天行程草案（包含交通、住宿、景点和大致费用）。
2. 用户登录后能保存行程并在不同设备上查看（Supabase 同步）。
3. 行程在地图视图中能显示每日轨迹与景点标注，能点击查看详情。
4. 基本费用估算能显示并支持手动录入实际费用；能导出费用明细。
5. 系统支持邀请协作者并设置访问权限（只读/可编辑）。

质量标准：单页关键功能无明显卡顿，前端组件有基础单元测试覆盖，API 调用错误处理友好。

## 十、风险与应对

- 第三方接口限额/稳定性（讯飞、Hunyuan-T1、高德）：增加重试、限流、备用方案，使用后端代理以便更好控制。
- 隐私与合规：收集最少必要数据，用户照片/票据仅在授权下上传并支持删除。
- LLM 输出不稳定/错误信息：使用结构化 schema + 校验 + 多候选生成并展现置信度。

## 十一、路线图与里程碑（建议）

阶段 0：准备（1 周）
- 完成 PRD 与设计稿
- 搭建基础仓库（Vite + Vue3 + Element Plus + Pinia + Supabase 配置）

阶段 1：MVP（3–5 周）
- 用户注册/登录（Supabase）
- 新建行程向导（文字输入）+ Hunyuan-T1 集成（行程生成）
- 行程展示（列表 + 日历 + 地图基本标注）
- 基本预算估算与费用记录

阶段 2：增强（4–6 周）
- 语音输入（科大讯飞）
- 地图高级交互（导航、路径规划）
- 邀请与共享、存储照片票据
- E2E 测试与 CI

阶段 3：优化与发布（2–4 周）
- 性能优化、UX 细节打磨
- 国际化、更多 LLM 提示优化
- 上线准备与文档

## 十二、验收测试用例（示例）

1. 新用户注册并创建行程 -> 成功保存到 Supabase -> 同设备查看
2. 语音输入行程需求（含偏好）-> 返回可编辑行程
3. 修改行程中某景点 -> 预算自动重新估算并显示变化
4. 记录一笔实际费用 -> 在费用统计页面显示并导出
5. 邀请协作者 -> 被邀请者收到链接并能查看/编辑（按权限）

## 十三、后续建议

- 建立示例提示词库（Prompt templates）以提高 Hunyuan-T1 结果一致性
- 添加缓存与离线支持（行程在本地可用，恢复后同步）
- 自动从邮件/票据中提取行程信息（高级）

---

（结束）
